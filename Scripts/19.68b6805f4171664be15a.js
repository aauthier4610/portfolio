(function(){var A=document&&document.currentScript&&document.currentScript.src;(window.webpackJsonpruntime=window.webpackJsonpruntime||[]).push([[19],{iThW:function(f,s,n){"use strict";n.r(s),n.d(s,"init",function(){return T}),n.d(s,"changeState",function(){return y});var h=n("yXPU"),c=n.n(h),u=n("DaUp"),d=n.n(u),S=n("zq3N");const m=d()({BUTTON:"BUTTON",ICON:"ICON"}),o={};function T(e){return Array.from(document.querySelectorAll(".dmLoginBar")).forEach(i=>{o[i.id]&&o[i.id].removeEventListeners(),o[i.id]=new l({container:i})}),o[(e||{}).id]||{}}function y(e,t){o[e].changeState(t)}const g=function(){var e=c()(function*(){return window.rtCommonProps["platform.monolith.loginBar.getUserLoggedIn.enabled"]?(yield window.dmAPI.getLoggedInUser()).userInfo:(yield window.dmAPI.getLoggedInMember()).memberInfo});return function(){return e.apply(this,arguments)}}();class l{constructor({container:t}){this.STATES={empty:{},loginButton:{},profileBar:{}},this.updateText=({state:i,element:r,text:a})=>{this.STATES[i][r].textContent=a,r==="memberNameSpan"&&this.STATES[i][r].setAttribute("data-label",a)},this.container=t,this.bindMethods(),this.initStates()}changeState(t){this.hideAll(),this.STATES[t].div.style.display="flex",this.container.setAttribute("data-showstate",t)}hideAll(){for(const t in this.STATES)this.STATES[t].hasOwnProperty("div")&&this.STATES[t].div!==null&&(this.STATES[t].div.style.display="none")}hideMyAccountLink(){this.changeMyAccount("none")}showMyAccountLink(){this.changeMyAccount(null)}changeMyAccount(t){const{myAccountLink:i}=this.STATES.profileBar;i&&(i.style.display=t)}bindMethods(){this.changeState=this.changeState.bind(this),this.hideAll=this.hideAll.bind(this),this.initStates=this.initStates.bind(this),this.initInitialState=this.initInitialState.bind(this)}initStates(){this.initEmptyState(),this.initLoginButtonState(),this.initProfileBarState(),this.initInitialState()}initInitialState(){var t=this;return c()(function*(){t.changeState("empty");try{const i=t.container.getAttribute("data-layout"),r=window.rtCommonProps["platform.monolith.loginBar.layout.enabled"],a=yield g();(!r||i===m.BUTTON)&&t.updateText({state:"profileBar",element:"memberNameSpan",text:`${a.firstname} ${a.lastname}`}),t.changeState("profileBar"),window.Snipcart&&t.showMyAccountLink(),document.addEventListener("snipcart.ready",()=>{t.showMyAccountLink()})}catch(i){t.changeState("loginButton")}})()}initEmptyState(){this.STATES.empty.div=this.container.querySelector(".empty-state")}initLoginButtonState(){this.STATES.loginButton.div=this.container.querySelector(".login-button-state")}handleClickMyAccount(){window.location.assign(`${window.location.pathname}#/dashboard`)}handleClickLogout(){return c()(function*(){try{yield fetch("/rts/auth/public/users/logout",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),window.location.reload()}catch(t){S.c.warn({dataString:{message:"Error logging out a user",error:t}})}})()}initProfileBarState(){const t=this.container.querySelector(".profile-bar-state");this.STATES.profileBar.div=t,this.STATES.profileBar.memberNameSpan=t.querySelector("#member-name"),this.STATES.profileBar.logoutLink=t.querySelector(".logout-link"),this.STATES.profileBar.myAccountLink=t.querySelector(".my-account-link"),this.hideMyAccountLink(),this.STATES.profileBar.myAccountLink.addEventListener("click",this.handleClickMyAccount),this.STATES.profileBar.logoutLink.addEventListener("click",this.handleClickLogout)}removeEventListeners(){this.STATES.profileBar.logoutLink.removeEventListener("click",this.handleClickLogout)}}l.displayName="LoginBar"}}])})();
